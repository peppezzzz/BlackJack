<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Blackjack Oracle PRO v4.1</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
            --primary: #bd00ff; --primary-glow: rgba(189, 0, 255, 0.6);
            --bg: #000; --panel: #0a0a0a; --border: #1a1a1a;
            --text: #fff; --win: #00ff88; --lose: #ff0055; --action: #00d4ff;
        }
        body { background: var(--bg); color: var(--text); font-family: sans-serif; margin: 0; padding: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        
        .tabs { display: flex; background: #050505; border-top: 1px solid var(--border); height: 70px; position: fixed; bottom: 0; width: 100%; z-index: 100; }
        .tab-btn { flex: 1; border: none; background: none; color: #555; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; text-transform: uppercase; }
        .tab-btn.active { color: var(--primary); }

        .section { flex: 1; display: none; padding: 15px; overflow-y: auto; margin-bottom: 75px; }
        .section.active { display: block; }

        .target-box { flex: 1; background: #0f0f0f; border: 2px solid var(--border); border-radius: 12px; padding: 12px; text-align: center; }
        .target-box.active { border-color: var(--primary); box-shadow: 0 0 20px var(--primary-glow); }
        .sum { font-size: 32px; font-weight: 900; }

        .strat-banner { background: #111; border: 2px solid var(--primary); border-radius: 12px; padding: 18px; text-align: center; font-size: 24px; font-weight: 900; margin-bottom: 15px; text-transform: uppercase; }

        .keypad { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin-bottom: 15px; }
        .key { height: 60px; border: none; border-radius: 10px; color: white; font-size: 24px; font-weight: 900; }
        .k-high { background: #d32f2f; } .k-low { background: #2e7d32; } .k-mid { background: #455a64; }

        .glass-card { background: var(--panel); border: 1px solid var(--border); border-radius: 16px; padding: 15px; margin-bottom: 12px; }
        .f-row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #1a1a1a; }
        .btn-main { background: var(--primary); border: none; border-radius: 12px; padding: 18px; color: white; font-weight: 900; width: 100%; font-size: 16px; box-shadow: 0 0 20px var(--primary-glow); }
        
        #config-sec { background: #000; position: fixed; inset: 0; z-index: 1000; display: flex; flex-direction: column; justify-content: center; padding: 30px; }
        .config-input { background: #111; border: 1px solid var(--border); border-radius: 10px; padding: 15px; color: white; width: 100%; margin: 10px 0; font-size: 18px; box-sizing: border-box; }
    </style>
</head>
<body>

    <div id="config-sec">
        <h1 style="color:var(--primary); text-align:center;">ORACLE PRO</h1>
        <label style="color:#888">BANKROLL (€)</label><input type="number" id="cfg-bank" class="config-input" value="1000">
        <label style="color:#888">MAZZI</label><input type="number" id="cfg-decks" class="config-input" value="8">
        <label style="color:#888">TAGLIO (%)</label><input type="number" id="cfg-pen" class="config-input" value="50">
        <button class="btn-main" onclick="initApp()">ATTIVA SISTEMA</button>
    </div>

    <div id="game-sec" class="section">
        <div style="display:flex; gap:10px; margin-bottom:15px;">
            <div id="box-p1" class="target-box active" onclick="setT('p1')"><div style="color:#888; font-size:10px;">TU</div><div id="sum-p1" class="sum">0</div></div>
            <div id="box-d" class="target-box" onclick="setT('d')"><div style="color:#888; font-size:10px;">BANCO</div><div id="sum-d" class="sum">0</div></div>
        </div>

        <div id="strat-box" class="strat-banner">READY</div>

        <div class="glass-card" style="display: flex; gap: 15px; text-align: center;">
            <div style="flex:1"><div style="color:#888; font-size:10px;">% 10</div><div id="p10-txt" style="color:var(--action); font-weight:bold;">30.7%</div></div>
            <div style="flex:1"><div style="color:#888; font-size:10px;">% ASSE</div><div id="pa-txt" style="color:var(--win); font-weight:bold;">7.7%</div></div>
        </div>

        <div class="keypad">
            <button class="key k-high" onclick="hit(11)">A</button>
            <button class="key k-low" onclick="hit(2)">2</button>
            <button class="key k-low" onclick="hit(3)">3</button>
            <button class="key k-low" onclick="hit(4)">4</button>
            <button class="key k-low" onclick="hit(5)">5</button>
            <button class="key k-low" onclick="hit(6)">6</button>
            <button class="key k-mid" onclick="hit(7)">7</button>
            <button class="key k-mid" onclick="hit(8)">8</button>
            <button class="key k-mid" onclick="hit(9)">9</button>
            <button class="key k-high" onclick="hit(10)">10</button>
        </div>

        <button class="btn-main" onclick="resolve()">FINE MANO</button>
        <button onclick="undo()" style="background:none; border:none; color:#ff8c00; width:100%; margin-top:10px; font-weight:bold;">ANNULLA ULTIMA CARTA</button>

        <div class="glass-card" style="display:grid; grid-template-columns: repeat(4, 1fr); margin-top:15px; text-align:center;">
            <div><div style="color:#888; font-size:9px;">RC</div><div id="ui-rc" style="color:var(--primary)">0</div></div>
            <div><div style="color:#888; font-size:9px;">TC</div><div id="ui-tc" style="color:var(--primary)">0.0</div></div>
            <div><div style="color:#888; font-size:9px;">BET</div><div id="ui-bet" style="color:var(--win)">1€</div></div>
            <div><div style="color:#888; font-size:9px;">CARTE</div><div id="ui-dealt">0</div></div>
        </div>
    </div>

    <div id="fin-sec" class="section">
        <h2 style="color:var(--primary)">FINANZE</h2>
        <div class="glass-card">
            <div class="f-row"><span>Giocate</span><span id="ui-h">0</span></div>
            <div class="f-row"><span>Vinte</span><span id="ui-w" style="color:var(--win)">0</span></div>
            <div class="f-row"><span>Perse</span><span id="ui-l" style="color:var(--lose)">0</span></div>
            <div class="f-row"><span>Pareggiate</span><span id="ui-p">0</span></div>
        </div>
        <div class="glass-card">
            <div class="f-row"><span>Bankroll Iniziale</span><span id="ui-start">1000€</span></div>
            <div class="f-row"><span>Saldo Attuale</span><span id="ui-bal" style="color:var(--win); font-weight:bold;">1000€</span></div>
            <div class="f-row"><span>Rendimento %</span><span id="ui-roi">0.0%</span></div>
        </div>
        <h3 style="color:#888; font-size:14px;">STORICO MANI</h3>
        <div id="history-list"></div>
    </div>

    <div class="tabs" id="nav-bar" style="display:none;">
        <button class="tab-btn" onclick="nav('fin-sec', this)"><i data-lucide="dollar-sign"></i>Finanze</button>
        <button class="tab-btn active" onclick="nav('game-sec', this)"><i data-lucide="activity"></i>Conteggio</button>
        <button class="tab-btn" onclick="fullReset()"><i data-lucide="settings"></i>Reset</button>
    </div>

    <script>
        let s = { bank: 1000, start: 1000, decks: 8, rc: 0, dealt: 0, c10: 0, cA: 0, p1: [], d: [], target: 'p1', stats: { h: 0, w: 0, l: 0, p: 0 }, hist: [], log: [] };
        const TAGS = { 11: -1, 2: 1, 3: 1, 4: 1, 5: 1, 6: 1, 7: 0, 8: 0, 9: 0, 10: -1 };

        function initApp() {
            s.start = parseFloat(document.getElementById('cfg-bank').value) || 1000;
            s.bank = s.start; s.decks = parseInt(document.getElementById('cfg-decks').value) || 8;
            document.getElementById('config-sec').style.display = 'none';
            document.getElementById('nav-bar').style.display = 'flex';
            update();
        }

        function hit(v) {
            s.rc += TAGS[v]; s.dealt++; s.log.push({ v, t: s.target });
            s[s.target].push(v);
            if (v === 10) s.c10++; if (v === 11) s.cA++;
            if (s.p1.length === 1 && s.d.length === 0) s.target = 'd';
            else if (s.p1.length === 1 && s.d.length === 1) s.target = 'p1';
            update();
        }

        function getSum(h) {
            let v = h.reduce((a, b) => a + b, 0), aces = h.filter(x => x === 11).length;
            while (v > 21 && aces > 0) { v -= 10; aces--; }
            return v;
        }

        function resolve() {
            let tc = s.rc / Math.max(1, (s.decks * 52 - s.dealt) / 52);
            let bet = (tc < 1) ? 1 : (tc < 2) ? 2 : (tc < 3) ? 5 : (tc < 4.5) ? 8 : 12;
            let ps = getSum(s.p1), ds = getSum(s.d);
            let res = "", gain = 0, color = "";

            if (ps > 21) { res = "SBALLATO"; gain = -bet; color = "var(--lose)"; s.stats.l++; }
            else if (ds > 21) { res = "BANCO SBALLA"; gain = bet; color = "var(--win)"; s.stats.w++; }
            else if (ps === 21 && s.p1.length === 2) { res = "BLACKJACK!"; gain = bet * 1.5; color = "var(--win)"; s.stats.w++; }
            else if (ps > ds) { res = "HAI VINTO"; gain = bet; color = "var(--win)"; s.stats.w++; }
            else if (ps < ds) { res = "HAI PERSO"; gain = -bet; color = "var(--lose)"; s.stats.l++; }
            else { res = "PAREGGIO"; gain = 0; color = "#888"; s.stats.p++; }

            s.bank += gain; s.stats.h++;
            s.hist.unshift({ m: res, v: (gain >= 0 ? "+" : "") + gain + "€", c: color });
            
            let banner = document.getElementById('strat-box');
            banner.innerText = res; banner.style.color = color; banner.style.borderColor = color;

            setTimeout(() => { 
                s.p1 = []; s.d = []; s.target = 'p1'; 
                update(); 
            }, 2000);
            save();
        }

        function update() {
            let tc = s.rc / Math.max(1, (s.decks * 52 - s.dealt) / 52);
            let ps = getSum(s.p1), dv = s.d[0] || 0;
            let rem = (s.decks * 52) - s.dealt;

            document.getElementById('sum-p1').innerText = ps;
            document.getElementById('sum-d').innerText = getSum(s.d);
            document.getElementById('ui-rc').innerText = s.rc;
            document.getElementById('ui-tc').innerText = tc.toFixed(1);
            document.getElementById('ui-bet').innerText = (tc < 1 ? 1 : tc < 2 ? 2 : tc < 3 ? 5 : tc < 4.5 ? 8 : 12) + "€";
            document.getElementById('ui-dealt').innerText = s.dealt;
            document.getElementById('p10-txt').innerText = (((s.decks * 16) - s.c10) / rem * 100).toFixed(1) + "%";
            document.getElementById('pa-txt').innerText = (((s.decks * 4) - s.cA) / rem * 100).toFixed(1) + "%";

            // LOGICA STRATEGIA & BLACKJACK
            let banner = document.getElementById('strat-box');
            if (ps === 21 && s.p1.length === 2) { banner.innerText = "BLACKJACK!"; banner.style.color = "var(--win)"; }
            else if (ps > 21) { banner.innerText = "SBALLATO"; banner.style.color = "var(--lose)"; }
            else if (ps >= 17) { banner.innerText = "STAI"; banner.style.color = "var(--lose)"; }
            else if (ps > 0 && dv > 0) {
                banner.innerText = (dv <= 6 && ps >= 13) ? "STAI" : "CHIAMA";
                banner.style.color = (dv <= 6 && ps >= 13) ? "var(--lose)" : "var(--win)";
            } else { banner.innerText = "READY"; banner.style.color = "var(--primary)"; }

            // UPDATE FINANZE
            document.getElementById('ui-bal').innerText = Math.round(s.bank) + "€";
            document.getElementById('ui-roi').innerText = (((s.bank - s.start) / s.start) * 100).toFixed(1) + "%";
            document.getElementById('ui-h').innerText = s.stats.h;
            document.getElementById('ui-w').innerText = s.stats.w;
            document.getElementById('ui-l').innerText = s.stats.l;
            document.getElementById('ui-p').innerText = s.stats.p;
            document.getElementById('ui-start').innerText = s.start + "€";

            let hHtml = ""; s.hist.slice(0, 10).forEach(i => {
                hHtml += `<div class="f-row"><span>${i.m}</span><span style="color:${i.c}">${i.v}</span></div>`;
            });
            document.getElementById('history-list').innerHTML = hHtml;
        }

        function undo() { if (s.log.length) { let l = s.log.pop(); s[l.t].pop(); s.rc -= TAGS[l.v]; if (l.v === 10) s.count10--; if (l.v === 11) s.countA--; s.dealt--; update(); } }
        function save() { localStorage.setItem('oracle_v4.1', JSON.stringify(s)); }
        function load() { let d = localStorage.getItem('oracle_v4.1'); if (d) { s = JSON.parse(d); document.getElementById('config-sec').style.display = 'none'; document.getElementById('nav-bar').style.display = 'flex'; update(); } }
        function nav(sec, btn) { document.querySelectorAll('.section').forEach(x => x.classList.remove('active')); document.getElementById(sec).classList.add('active'); document.querySelectorAll('.tab-btn').forEach(x => x.classList.remove('active')); btn.classList.add('active'); lucide.createIcons(); }
        function fullReset() { if (confirm("CANCELLARE TUTTO?")) { localStorage.clear(); location.reload(); } }
        window.onload = () => { load(); lucide.createIcons(); };
    </script>
</body>
</html>
